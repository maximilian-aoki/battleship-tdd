(()=>{"use strict";const e=new class{constructor(){this.events={}}on(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}off(e,t){if(this.events[e])for(let r=0;r<this.events[e].length;r+=1)this.events[e][r]===t&&this.events[e].splice(r,1)}emit(e,t){this.events[e]&&this.events[e].forEach((e=>{e(t)}))}};class t{constructor(e,t){this.length=e,this.symbol=t,this.hits=0,this.isSunk=!1}hit(){!1===this.isSunk&&(this.hits+=1,this.isSunk=this.hits>=this.length)}}class r{constructor(e){this.board=this.#e(e),this.size=e,this.ships=[]}#e(e){const t=[];for(let r=0;r<e;r+=1){const r=[];for(let t=0;t<e;t+=1)r.push("");t.push(r)}return t}placeShip(e,r,a){const[n,o]=this.#t(a);if(this.#r(e,r,n)||this.#a(e,r,n))return"illegal move";this.ships.push(new t(n,o)),this.#n(e,r,n,o)}#t(e){if("carrier"===e)return[5,"C"];if("battleship"===e)return[4,"B"];if("destroyer"===e)return[3,"D"];if("submarine"===e)return[3,"S"];if("patrol"===e)return[2,"P"];throw new Error("improper boat name format")}#r(e,t,r){return"h"===e?t[1]+(r-1)>=this.size:"v"===e?t[0]+(r-1)>=this.size:void 0}#a(e,t,r){if("h"===e){const e=t[0];for(let a=t[1];a<t[1]+r;a+=1)if(""!==this.board[e][a])return!0}if("v"===e){const e=t[1];for(let a=t[0];a<t[0]+r;a+=1)if(""!==this.board[a][e])return!0}}#n(e,t,r,a){if("h"===e){const e=t[0];for(let n=t[1];n<t[1]+r;n+=1)this.board[e][n]=a}if("v"===e){const e=t[1];for(let n=t[0];n<t[0]+r;n+=1)this.board[n][e]=a}}receiveAttack(e){if(""===this.board[e[0]][e[1]])return this.board[e[0]][e[1]]="o",["miss"];if("o"===this.board[e[0]][e[1]]||"x"===this.board[e[0]][e[1]])return["already targeted coordinate"];const t={boat:void 0,isSunk:void 0};return this.ships.forEach((r=>{r.symbol===this.board[e[0]][e[1]]&&(r.hit(),t.boat=r.symbol,t.isSunk=r.isSunk)})),this.board[e[0]][e[1]]="x",["hit",t]}checkAllSunk(){for(let e=0;e<this.ships.length;e+=1)if(!this.ships[e].isSunk)return!1;return!0}}class a{constructor(){this.playerBoard=new r(10),this.allCoords=this.#o(10)}#o(e){const t=[];for(let r=0;r<e;r+=1)for(let a=0;a<e;a+=1)t.push([r,a]);return t}placeShip(e,t,r){return this.playerBoard.placeShip(e,t,r)}attack(e,t){return e.playerBoard.receiveAttack(t)}randomAttack(e){const t=Math.floor(Math.random()*this.allCoords.length),r=this.allCoords[t];this.allCoords.splice(t,1),"hit"===this.attack(e,r)[0]&&this.randomAttack(e)}randomPlaceShips(){["carrier","battleship","destroyer","submarine","patrol"].forEach((e=>{this.#i(e)}))}#i(e){const t=["v","h"][Math.floor(2*Math.random())],r=this.allCoords[Math.floor(100*Math.random())];"illegal move"===this.placeShip(t,r,e)&&this.#i(e)}}const n={player:{currentBoard:void 0,remainingShips:[["battleship",4],["destroyer",3],["submarine",3],["patrol",2]],currentShip:["carrier",5],currentOrientation:"v",squaresToRender:[]},computer:{currentBoard:void 0}},o=document.querySelector(".player-frame"),i=document.querySelector(".computer-frame");function s(e){"v"!==e.key&&"V"!==e.key||(n.player.currentOrientation="v",p()),"h"!==e.key&&"H"!==e.key||(n.player.currentOrientation="h",p())}function l(e,t,r){e.removeChild(e.firstElementChild);const a=document.createElement("div");a.classList.add("board"),a.classList.add("grid");for(let n=0;n<t.playerBoard.board.length;n+=1)for(let i=0;i<t.playerBoard.board.length;i+=1){const s=document.createElement("div");s.setAttribute("data-index",`${n}${i}`),r(s),e===o&&""!==t.playerBoard.board[n][i]&&s.classList.add("ship"),"x"===t.playerBoard.board[n][i]&&s.classList.add("hit"),"o"===t.playerBoard.board[n][i]&&s.classList.add("miss"),a.appendChild(s)}e.appendChild(a)}function d(e){e.addEventListener("mouseover",c),e.addEventListener("mouseout",h),e.addEventListener("click",u)}function c(e){const t=Array.isArray(e)?e:e.target.getAttribute("data-index").split("").map((e=>Number(e)));let r="valid";if("v"===n.player.currentOrientation){t[0]+n.player.currentShip[1]>10&&(r="invalid");const e=t[1];for(let a=t[0];a<t[0]+n.player.currentShip[1]&&a<10;a+=1)n.player.squaresToRender.push([a,e]),""!==n.player.currentBoard[a][e]&&(r="invalid")}if("h"===n.player.currentOrientation){t[1]+n.player.currentShip[1]>10&&(r="invalid");const e=t[0];for(let a=t[1];a<t[1]+n.player.currentShip[1]&&a<10;a+=1)n.player.squaresToRender.push([e,a]),""!==n.player.currentBoard[e][a]&&(r="invalid")}!function(e){n.player.squaresToRender.forEach((t=>{document.querySelector(`[data-index='${t[0]}${t[1]}']`).classList.add(e)}))}(r)}function h(){n.player.squaresToRender.forEach((e=>{const t=document.querySelector(`[data-index='${e[0]}${e[1]}']`);t.classList.remove("invalid"),t.classList.remove("valid")})),n.player.squaresToRender=[]}function p(){if(n.player.squaresToRender.length>0){const e=n.player.squaresToRender[0];h(),c(e)}}function u(t){if("valid"===t.target.getAttribute("class")){const r=t.target.getAttribute("data-index").split("").map((e=>Number(e)));n.player.remainingShips.length>0?(e.emit("place ship",{orientation:n.player.currentOrientation,coordArr:r,boat:n.player.currentShip[0],nextBoat:n.player.remainingShips[0][0]}),n.player.currentShip=n.player.remainingShips.shift()):0===n.player.remainingShips.length&&(e.emit("place final ship",{orientation:n.player.currentOrientation,coordArr:r,boat:n.player.currentShip[0]}),window.removeEventListener("keydown",s))}}function m(e){e.style.cursor="auto"}function y(e){e.addEventListener("mouseover",f),e.addEventListener("mouseout",b),e.addEventListener("click",v)}function f(e){const[t,r]=e.target.getAttribute("data-index").split("").map((e=>Number(e)));"x"!==n.computer.currentBoard[t][r]&&"o"!==n.computer.currentBoard[t][r]&&e.target.classList.add("available")}function b(e){e.target.classList.remove("available")}function v(t){if("available"===t.target.getAttribute("class")){const r=t.target.getAttribute("data-index").split("").map((e=>Number(e)));e.emit("player sends attack",r)}}window.addEventListener("keydown",s),e.on("init board placement",(e=>{n.player.currentBoard=e.playerBoard.board,l(o,e,d)})),e.on("render attack board",(e=>{n.player.currentBoard=e[0].playerBoard.board,n.computer.currentBoard=e[1].playerBoard.board,l(o,e[0],m),l(i,e[1],y)})),e.on("player miss",(e=>{n.player.currentBoard=e[0].playerBoard.board,n.computer.currentBoard=e[1].playerBoard.board,l(o,e[0],m),l(i,e[1],m)})),e.on("player won",(e=>{n.player.currentBoard=e[0].playerBoard.board,n.computer.currentBoard=e[1].playerBoard.board,l(o,e[0],m),l(i,e[1],m)})),e.on("computer won",(e=>{n.player.currentBoard=e[0].playerBoard.board,n.computer.currentBoard=e[1].playerBoard.board,l(o,e[0],m),l(i,e[1],m)}));const g=document.querySelector(".messages");e.on("change placement message",(function(e){g.innerHTML=`\n    <h2>Now place your ${e.toUpperCase()}</h2>\n    <p>(toggle 'v' for vertical and 'h' for horizontal)</p>\n    `})),e.on("ready fire message",(function(){g.innerHTML="\n    <h2>ðŸ”« Fire when ready ðŸ”«</h2>\n    "})),e.on("player hit status message",(function(e){const t="C"===(a=e.boat)?"CARRIER":"B"===a?"BATTLESHIP":"D"===a?"DESTROYER":"S"===a?"SUBMARINE":"P"===a?"PATROL":void 0,r=e.isSunk?"sunk":"hit";var a;g.innerHTML=`\n    <h2>ðŸ’¥ You ${r} the enemy's ${t}! ðŸ’¥</h2>\n    <p>Fire again when ready...</p>\n    `})),e.on("player miss",(function(){g.innerHTML="\n    <h2>You shot and missed!</h2>\n    <p>Opponent is sending a volley...</p>\n    "})),e.on("computer shot message",(function(){g.innerHTML="\n    <h2>Your opponent has fired their shots!</h2>\n    <p>ðŸ”« Fire when ready ðŸ”«</p>\n    "})),e.on("player won",(function(){g.innerHTML="\n    <h2>ðŸ‘‘ Congrats, you sunk all the enemy ships and won the battle! ðŸ‘‘</h2>\n    <p>Refresh the browser to play again.</p>\n    "})),e.on("computer won",(function(){g.innerHTML="\n    <h2>ðŸ’€ Your opponent sunk all your ships, you lost the battle! ðŸ’€</h2>\n    <p>Refresh the browser to play again.</p>\n    "}));const B=new a,S=new a;e.emit("init board placement",B),e.on("place ship",(t=>{B.placeShip(t.orientation,t.coordArr,t.boat),e.emit("change placement message",t.nextBoat),e.emit("init board placement",B)})),e.on("place final ship",(t=>{B.placeShip(t.orientation,t.coordArr,t.boat),S.randomPlaceShips(),e.emit("ready fire message"),e.emit("render attack board",[B,S])})),e.on("player sends attack",(t=>{const r=B.attack(S,t);"hit"===r[0]?S.playerBoard.checkAllSunk()?e.emit("player won",[B,S]):(e.emit("player hit status message",r[1]),e.emit("render attack board",[B,S])):(e.emit("player miss",[B,S]),setTimeout((()=>{S.randomAttack(B),B.playerBoard.checkAllSunk()?e.emit("computer won",[B,S]):(e.emit("computer shot message"),e.emit("render attack board",[B,S]))}),500))}))})();
//# sourceMappingURL=app.bundle.js.map